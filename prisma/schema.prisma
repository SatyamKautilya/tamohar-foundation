generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================
// VILLAGE MODULE - Core entity; every other entity links here
// ============================================================

model Village {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?  @db.Text
  state       String
  district    String
  population  Int?
  latitude    Float?
  longitude   Float?
  heroImage   String?
  thumbnail   String?
  established DateTime?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  programs      Program[]
  events        Event[]
  shgs          SHG[]
  media         Media[]
  impactMetrics ImpactMetric[]

  @@index([slug])
  @@index([state, district])
}

// ============================================================
// PROGRAMS
// ============================================================

enum FocusArea {
  HEALTH
  EDUCATION
  ECONOMY
  EMPLOYMENT
  SHG
  GOVERNMENT_SCHEMES
  ENVIRONMENT
  INFRASTRUCTURE
  OTHER
}

model Program {
  id               String    @id @default(cuid())
  title            String
  slug             String    @unique
  description      String?   @db.Text
  focusArea        FocusArea
  startDate        DateTime?
  endDate          DateTime?
  isActive         Boolean   @default(true)
  thumbnail        String?
  beneficiaryCount Int       @default(0)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  villageId String
  village   Village @relation(fields: [villageId], references: [id], onDelete: Cascade)
  events    Event[]

  @@index([villageId])
  @@index([focusArea])
  @@index([slug])
}

// ============================================================
// EVENTS
// ============================================================

enum EventStatus {
  UPCOMING
  ONGOING
  COMPLETED
  CANCELLED
}

model Event {
  id               String      @id @default(cuid())
  title            String
  slug             String      @unique
  description      String?     @db.Text
  date             DateTime
  endDate          DateTime?
  location         String?
  status           EventStatus @default(UPCOMING)
  beneficiaryCount Int         @default(0)
  heroImage        String?
  isPublished      Boolean     @default(false)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  villageId String
  village   Village  @relation(fields: [villageId], references: [id], onDelete: Cascade)
  programId String?
  program   Program? @relation(fields: [programId], references: [id], onDelete: SetNull)
  media     Media[]

  @@index([villageId])
  @@index([slug])
  @@index([date])
  @@index([status])
}

// ============================================================
// SELF HELP GROUPS
// ============================================================

model SHG {
  id             String    @id @default(cuid())
  name           String
  slug           String    @unique
  description    String?   @db.Text
  memberCount    Int       @default(0)
  formedDate     DateTime?
  category       String?
  savingsTotal   Float     @default(0)
  loansDisbursed Float     @default(0)
  isActive       Boolean   @default(true)
  thumbnail      String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  villageId String
  village   Village @relation(fields: [villageId], references: [id], onDelete: Cascade)

  @@index([villageId])
  @@index([slug])
}

// ============================================================
// MEDIA
// ============================================================

enum MediaType {
  IMAGE
  VIDEO
  DOCUMENT
}

model Media {
  id        String    @id @default(cuid())
  url       String
  publicId  String?
  type      MediaType @default(IMAGE)
  caption   String?
  altText   String?
  width     Int?
  height    Int?
  createdAt DateTime  @default(now())

  villageId String?
  village   Village? @relation(fields: [villageId], references: [id], onDelete: SetNull)
  eventId   String?
  event     Event?   @relation(fields: [eventId], references: [id], onDelete: SetNull)

  @@index([villageId])
  @@index([eventId])
}

// ============================================================
// IMPACT METRICS
// ============================================================

model ImpactMetric {
  id        String    @id @default(cuid())
  label     String
  value     Float
  unit      String?
  category  FocusArea
  year      Int?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  villageId String
  village   Village @relation(fields: [villageId], references: [id], onDelete: Cascade)

  @@index([villageId])
  @@index([category])
}

// ============================================================
// DONATIONS (future-ready)
// ============================================================

enum DonationStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

model Donation {
  id            String         @id @default(cuid())
  amount        Float
  currency      String         @default("INR")
  donorName     String?
  donorEmail    String?
  donorPhone    String?
  message       String?
  isAnonymous   Boolean        @default(false)
  status        DonationStatus @default(PENDING)
  transactionId String?        @unique
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([status])
  @@index([createdAt])
}

// ============================================================
// ADMIN USERS
// ============================================================

enum Role {
  ADMIN
  EDITOR
  VIEWER
}

model AdminUser {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  role      Role     @default(EDITOR)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}

// ============================================================
// CONTACT SUBMISSIONS
// ============================================================

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String?
  message   String   @db.Text
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([isRead])
  @@index([createdAt])
}
